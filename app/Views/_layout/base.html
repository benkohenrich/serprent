<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>{{ page_title ~ ' - ' ~  '[' ~ config('app.site_name') ~ ']' }}</title>

    {#Toastr#}
    <link href="{{ file(['styles', 'plugins', 'toastr', 'toastr.css']) }}" rel="stylesheet">

    {#Animate#}
    <link href="{{ file(['styles', 'plugins', 'animate', 'animate.css']) }}" rel="stylesheet">

    {#Parsley#}
    <link href="{{ file(['styles', 'plugins', 'parsley', 'parsley.css']) }}" rel="stylesheet">

    {#Datatables#}
    <link href="{{ file(['styles', 'plugins', 'data-tables', 'datatables.min.css']) }}" rel="stylesheet">

    {#Bootstrap DateTimePicker#}
    <link href="{{ file(['styles', 'plugins', 'bootstrap-datetimepicker', 'bootstrap-datetimepicker.css']) }}" rel="stylesheet">

    {#Inspinia, Bootstrap, Font-Awesome, Custom#}
    <link href="{{ file(['styles', 'style.css']) }}" rel="stylesheet">

    {% block css %}

    {% endblock %}
  </head>

  <body>
    <div id="wrapper">

      {%- import '_macros/forms.html' as forms_macro -%}

      {% include '_partials/navigation/vertical.html' %}

      <div id="page-wrapper" class="gray-bg">

        {% include '_partials/navigation/horizontal.html' %}

        {% include '_partials/breadcrumbs.html' %}

        {#Content#}
        <div class="wrapper wrapper-content animated fadeInRight">
          {% block content %}
          {% endblock %}
        </div>
      </div>
    </div>

    {#JavaScript#}

    {#jQuery#}
    <script src="{{ file(['scripts', 'plugins', 'jquery', 'jquery-3.1.1.min.js']) }}"></script>

    {#jQueryUI#}
    <script src="{{ file(['scripts', 'plugins', 'jquery-ui', 'jquery-ui.min.js']) }}"></script>

    {#Bootstrap#}
    <script src="{{ file(['scripts', 'plugins', 'bootstrap', 'bootstrap.min.js']) }}"></script>

    {#Inspinia#}
    <script src="{{ file(['scripts', 'plugins', 'inspinia', 'inspinia.js']) }}"></script>

    {#Toastr#}
    <script src="{{ file(['scripts', 'plugins', 'toastr', 'toastr.min.js' ]) }}"></script>

    {#MetisMenu#}
    <script src="{{ file(['scripts', 'plugins', 'metis-menu', 'jquery.metisMenu.js' ]) }}"></script>

    {#SlimScroll#}
    <script src="{{ file(['scripts', 'plugins', 'slimscroll', 'jquery.slimscroll.min.js']) }}"></script>

    {#Pace#}
    <script src="{{ file(['scripts', 'plugins', 'pace', 'pace.min.js']) }}"></script>

    {#Datatables#}
    <script src="{{ file(['scripts', 'plugins', 'data-tables', 'datatables.min.js']) }}"></script>

    {#MomentJs#}
    <script src="{{ file(['scripts', 'plugins', 'moment', 'moment.js']) }}"></script>

    {#Bootstrap DateTimePicker#}
    <script src="{{ file(['scripts', 'plugins', 'bootstrap-datetimepicker', 'bootstrap-datetimepicker.js']) }}"></script>
    <script src="{{ file(['scripts', 'plugins', 'bootstrap-datetimepicker', 'locales', 'bootstrap-datetimepicker.sk.js']) }}"></script>
    <script src="{{ file(['scripts', 'plugins', 'bootstrap-datetimepicker', 'locales', 'bootstrap-datetimepicker.en.js']) }}"></script>
    <script src="{{ file(['scripts', 'plugins', 'bootstrap-datetimepicker', 'locales', 'bootstrap-datetimepicker.hu.js']) }}"></script>

    {#Parsley#}
    <script src="{{ file(['scripts', 'plugins', 'parsley', 'parsley.min.js']) }}"></script>
    <script src="{{ file(['scripts', 'plugins', 'parsley', 'i18n', 'sk.js' ]) }}"></script>
    <script src="{{ file(['scripts', 'plugins', 'parsley', 'i18n', 'hu.js' ]) }}"></script>
    <script src="{{ file(['scripts', 'plugins', 'parsley', 'i18n', 'en.js' ]) }}"></script>

    {#Custom JS#}
    <script src="{{ file(['scripts', 'scripts.js' ]) }}"></script>


    {% block javascript %}{% endblock %}

    <script>
      $(document).ready(function () {

        // TOASTR FLASH
        {% if flash is not empty %}
          {% if not flash[1] %}
            toastr.info("{{ flash }}");
          {% else %}
            toastr.{{ flash[1] }}("{{ flash[0] }}");
          {% endif %}
        {% endif %}

        // Bootstrap DateTimePicker options
        $('#date-picker').datetimepicker({
          format: 'dd.mm.yyyy',
          startView: 'month',
          minView: 'month',
          maxView: 'decade',
          autoclose: true,
          language: '{{ self.language_code }}'
        });

        $('#datetime-picker').datetimepicker({
          format: 'dd.mm.yyyy hh:ii',
          startView: 'month',
          minView: 'hour',
          maxView: 'decade',
          autoclose: true,
          language: '{{ self.language_code }}'
        });

        $('#time-picker').datetimepicker({
          format: 'hh:ii',
          startView: 'day',
          minView: 'hour',
          maxView: 'day',
          autoclose: true,
          timeOnly: true,
          language: '{{ self.language_code }}'
        });

        // FORM HANDLING
        {% if form_id is defined %}

          {% if save_success %}
            toastr.success('{{ save_success }}');
          {% endif %}

          window.Parsley.setLocale('{{ self.language_code }}');

          var formSelector    = $('#{{ form_id }}');
          var validator       = formSelector.parsley([

          ]);
          var submitClicked   = false;

          validator.on('form:success', function () {
            $.ajax({
              method  : "POST",
              url     : formSelector.attr('action'),
              data    : {
                'form_data' : JSON.stringify(formSelector.serialize())
              },
              success: function (data) {
                var parsedData        = JSON.parse(data);
                window.location.href  = parsedData.route;
              },
              error: function (response) {
                var message       = response.responseText;
                var parsedErrors  = JSON.parse(message);
                var errorMsg      = '';

                for (var i = 0; i < parsedErrors.length; i++) {
                  errorMsg = errorMsg + parsedErrors[i].message;

                  if (i + 1 !== parsedErrors.length) {
                    errorMsg = errorMsg + '<br>';
                  }
                }

                toastr.error(errorMsg);
              }
            });
          });

          validator.on('form:error', function () {
            submitClicked     = false;
          });

          $('#form-submit-button').on('click', function () {
            setTimeout(function () {
              submitClicked   = true;
              validator.validate();
            });
          });
        {% endif %}
      });
    </script>

  </body>
</html>