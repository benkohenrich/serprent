{% extends '_layout/base.html' %}

{% block content %}

  <form id="{{ form_id }}" method="post" action="{{ uri([ 'users', 'create' ]) }}" enctype="multipart/form-data">

    <input type="hidden" name="save" value="1">
    <input type="hidden" name="client_id" value="{{ self.client.id }}">

    <div class="row">
      <div class="col-lg-6">
        <div class="ibox float-e-margins">
          <div class="ibox-title">
            <h5>{{ i18n('users.form.headers.user_info') }}</h5>
          </div>
          <div class="ibox-content">
            <div class="row">
              <div class="col-sm-6">
                {{ forms_macro.input_text('name', 'users.form.inputs.name', '', true, _context) }}
              </div>

              <div class="col-sm-6">
                {{ forms_macro.input_text('surname', 'users.form.inputs.surname', '', true, _context) }}
              </div>
            </div>

            <div class="row">
              <div class="col-sm-6">
                {% set equal_to = '#password_again' %}
                {{ forms_macro.input_password('password', 'users.form.inputs.password', config('app.password_pattern'),
                    true, _context) }}
                {% set equal_to = '' %}
              </div>

              <div class="col-sm-6">
                {% set equal_to = '#password' %}
                {{ forms_macro.input_password('password_again', 'users.form.inputs.password_again',
                    config('app.password_pattern'), true, _context) }}
                {% set equal_to = '' %}
              </div>
            </div>

            <div class="row">
              <div class="col-sm-6">
                {{ forms_macro.input_email('email', 'users.form.inputs.email', '', true, _context) }}
              </div>

              <div class="col-sm-6">
                {{ forms_macro.select('language_id', 'users.form.inputs.language_id', languages, '', true, _context) }}
              </div>
            </div>

            <div class="row">
              <div class="col-sm-6">
                {{ forms_macro.checkbox('is_active', 'users.form.inputs.is_active', true, false, _context) }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="ibox float-e-margins">
          <div class="ibox-title">
            <h5>{{ i18n('users.form.headers.role_info') }}</h5>
          </div>
          <div class="ibox-content">

            <div class="row">
              <div class="col-sm-12">
                {{ forms_macro.select('role_id', 'users.form.inputs.role_id', roles, '', true, _context) }}
              </div>
            </div>

            <div class="row">
              <div class="col-sm-12">
                <label>{{ i18n('users.form.inputs.permissions') ~ '*' }}</label>

                {% for permission in permissions %}
                  <div class="row role-permissions" data-role-id="{{ permission.role_id }}">
                    <div class="col-lg-12">
                      {{ forms_macro.checkbox('permissions[]', 'app.permissions.' ~ permission.code, true, false, _context) }}
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

  </form>

{% endblock %}

{% block javascript %}
  <script>
    $(document).ready(function () {

      $('#role_id').on('change', function () {
        var selectedRole  = $('#role_id option:selected').val();

        $('.role-permissions').hide();
        $('.role-permissions[data-role-id=' + selectedRole + ']').show();
      }).trigger('change');

    });
  </script>
{% endblock %}